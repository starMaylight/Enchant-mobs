# Manual Build & Release (Gradle + Java 17)
name: Manual Build & Release

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'Tag name to create release for (e.g. v1.2.3)'
        required: true
      release_name:
        description: 'Release title (optional)'
        required: false
      release_body:
        description: 'Release notes/body (optional)'
        required: false
      prerelease:
        description: 'Mark as prerelease? (true/false)'
        required: false
        default: 'false'
      generate_release_notes:
        description: 'Generate release notes automatically? (true/false)'
        required: false
        default: 'false'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure Gradle wrapper is executable
        run: chmod +x ./gradlew || true

      - name: Set up Java 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Cache Gradle
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            gradle-${{ runner.os }}-

      - name: Build (Gradle)
        run: ./gradlew clean build --no-daemon

      - name: Create GitHub Release and upload artifacts
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ inputs.tag }}
          name: ${{ inputs.release_name || inputs.tag }}
          body: ${{ inputs.release_body }}
          generateReleaseNotes: ${{ inputs.generate_release_notes }}

          artifacts: build/libs/*.jar
          draft: false
          prerelease: ${{ inputs.prerelease }}
